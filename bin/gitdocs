#!/usr/local/env ruby

require 'gitdocs'

dirs = ARGV
dirs << File.expand_path(Dir.pwd, File.dirname(__FILE__)) if dirs.empty?

pids = dirs.map do |dir|
  fork do
    Dir.chdir(dir) do
      Gitdocs.new(Dir.pwd).run
    end
  end
end

pids.each do |pid|
  Process.waitpid(pid)
end

at_exit do
  pids.each do |pid|
    Process.kill("INT", pid) rescue nil
  end
end